<?xml version="1.0" encoding="utf-8"?>
<Window x:Class="MyNotes.Core.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="using:MyNotes.Common.Converters"
        xmlns:views="using:MyNotes.Core.Views"
        xmlns:models="using:MyNotes.Core.Models">

  <Window.SystemBackdrop>
    <MicaBackdrop />
  </Window.SystemBackdrop>

  <Grid x:Name="VIEW_RootGrid">
    <Grid.Resources>
      <SolidColorBrush x:Key="NavigationViewContentBackground"
                       Color="Transparent" />
      <Thickness x:Key="NavigationViewContentGridBorderThickness">0</Thickness>
      <Thickness x:Key="NavigationViewMinimalContentGridBorderThickness">0</Thickness>
      <SolidColorBrush x:Key="TitleBarBackButtonBackgroundDisabled"
                       Color="{ThemeResource SubtleFillColorDisabled}" />
      <x:Double x:Key="TitleBarCompactHeight">40</x:Double>

      <views:MainNavigationViewMenuItemTemplateSelector x:Key="MainNavigationViewMenuItemTemplateSelector">
        <views:MainNavigationViewMenuItemTemplateSelector.GroupItemTemplate>
          <DataTemplate x:DataType="models:NavigationGroupItem">
            <NavigationViewItem MenuItemsSource="{x:Bind Children}"
                                AllowDrop="True"
                                DragEnter="NavigationViewItem_DragEnter">
              <NavigationViewItem.Content>
                <Grid>
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="Auto" />
                  </Grid.ColumnDefinitions>
                  <TextBlock Text="{x:Bind Name, Mode=OneWay}" />
                  <FontIcon Grid.Column="1"
                            Glyph="&#xE7C2;"
                            FontSize="14"
                            CanDrag="True"
                            Visibility="{x:Bind converters:BoolToVisibilityConverter.Convert(IsMovable), Mode=OneWay}" />
                </Grid>
              </NavigationViewItem.Content>
              <NavigationViewItem.Icon>
                <IconSourceElement IconSource="{x:Bind Icon, Mode=OneWay}"/>
              </NavigationViewItem.Icon>
            </NavigationViewItem>
          </DataTemplate>
        </views:MainNavigationViewMenuItemTemplateSelector.GroupItemTemplate>

        <views:MainNavigationViewMenuItemTemplateSelector.MenuItemTemplate>
          <DataTemplate x:DataType="models:NavigationItem">
            <NavigationViewItem>
              <NavigationViewItem.Content>
                <Grid>
                  <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="Auto" />
                  </Grid.ColumnDefinitions>
                  <TextBlock Text="{x:Bind Name, Mode=OneWay}" />
                  <FontIcon Grid.Column="1"
                            Glyph="&#xE7C2;"
                            FontSize="14"
                            CanDrag="True"
                            Visibility="{x:Bind converters:BoolToVisibilityConverter.Convert(IsMovable), Mode=OneWay}" />
                </Grid>
              </NavigationViewItem.Content>
              <NavigationViewItem.Icon>
                <IconSourceElement IconSource="{x:Bind Icon, Mode=OneWay}" />
              </NavigationViewItem.Icon>
            </NavigationViewItem>
          </DataTemplate>
        </views:MainNavigationViewMenuItemTemplateSelector.MenuItemTemplate>

        <views:MainNavigationViewMenuItemTemplateSelector.SeparatorTemplate>
          <DataTemplate x:DataType="models:NavigationSeparator">
            <NavigationViewItemSeparator />
          </DataTemplate>
        </views:MainNavigationViewMenuItemTemplateSelector.SeparatorTemplate>
      </views:MainNavigationViewMenuItemTemplateSelector>
    </Grid.Resources>

    <Grid.RowDefinitions>
      <RowDefinition Height="48" />
      <RowDefinition />
    </Grid.RowDefinitions>

    <TitleBar x:Name="VIEW_TitleBar"
              Grid.Row="0"
              IsBackButtonEnabled="{x:Bind VIEW_NavigationContent_RootFrame.CanGoBack, Mode=OneWay}"
              IsBackButtonVisible="True"
              BackRequested="VIEW_TitleBar_BackRequested"
              IsPaneToggleButtonVisible="False"
              Margin="2,0,0,0"
              Title="MyNotes">
      <TitleBar.IconSource>
        <ImageIconSource ImageSource="ms-appx:///Assets/icons/app/AppIcon_16.png" />
      </TitleBar.IconSource>
    </TitleBar>

    <NavigationView x:Name="VIEW_NavigationView"
                    Grid.Row="1"
                    IsBackButtonVisible="Collapsed"
                    IsPaneToggleButtonVisible="True"
                    IsSettingsVisible="False"
                    MenuItemTemplateSelector="{StaticResource MainNavigationViewMenuItemTemplateSelector}"
                    MenuItemsSource="{x:Bind ViewModel.MenuItems.View}"
                    FooterMenuItemsSource="{x:Bind ViewModel.FooterMenuItems}"
                    SelectionChanged="VIEW_NavigationView_SelectionChanged"
                    PaneTitle="MyNotes">
      <NavigationView.AutoSuggestBox>
        <AutoSuggestBox PlaceholderText="Search notes"
                        QueryIcon="Find"
                        QuerySubmitted="AutoSuggestBox_QuerySubmitted">
        </AutoSuggestBox>
      </NavigationView.AutoSuggestBox>

      <NavigationView.Content>
        <Frame x:Name="VIEW_NavigationContent_RootFrame"
               Padding="0,0,0,0"
               Navigated="VIEW_NavigationContent_RootFrame_Navigated" />
      </NavigationView.Content>

      <NavigationView.PaneFooter>
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition />
            <ColumnDefinition />
          </Grid.ColumnDefinitions>
          <NavigationViewItem x:Name="VIEW_NavigationViewFooter_AddNavigationViewItem"
                              Grid.Column="0"
                              Content="Add"
                              Icon="Add"
                              Tapped="NavigationViewItem_Tapped">
            <FlyoutBase.AttachedFlyout>
              <MenuFlyout Placement="TopEdgeAlignedLeft">
                <MenuFlyoutItem Text="Add Group"
                                Icon="Add" />
                <MenuFlyoutItem Text="Add List"
                                Icon="Add" />
              </MenuFlyout>
            </FlyoutBase.AttachedFlyout>
          </NavigationViewItem>
          <Button x:Name="VIEW_NavigationViewFooter_EditButton"
                  Grid.Column="1"
                  Content="Edit"
                  Style="{StaticResource AppBasicButtonStyle}">
            <Button.Flyout>
              <Flyout Placement="RightEdgeAlignedBottom">
                <views:NavigationEditor />
              </Flyout>
            </Button.Flyout>
          </Button>
        </Grid>
      </NavigationView.PaneFooter>
    </NavigationView>
  </Grid>
</Window>
