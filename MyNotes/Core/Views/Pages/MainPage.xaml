<?xml version="1.0" encoding="utf-8"?>
<Page x:Class="MyNotes.Core.Views.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:ui="using:CommunityToolkit.WinUI"
      xmlns:models="using:MyNotes.Core.Models"
      xmlns:views="using:MyNotes.Core.Views">

  <Page.Resources>
    <SolidColorBrush x:Key="NavigationViewContentBackground"
                     Color="Transparent" />
    <Thickness x:Key="NavigationViewContentGridBorderThickness">0</Thickness>
    <Thickness x:Key="NavigationViewMinimalContentGridBorderThickness">0</Thickness>
    <SolidColorBrush x:Key="TitleBarBackButtonBackgroundDisabled"
                     Color="{ThemeResource SubtleFillColorDisabled}" />
    <x:Double x:Key="TitleBarCompactHeight">40</x:Double>
    <views:MainNavigationViewMenuItemTemplateSelector x:Key="MainNavigationViewMenuItemTemplateSelector">
      <!--#region MenuItemTemplate: Menu Item-->
      <views:MainNavigationViewMenuItemTemplateSelector.MenuItemTemplate>
        <DataTemplate x:DataType="models:NavigationItem">
          <NavigationViewItem DataContext="{x:Bind}"
                              Content="{x:Bind Name, Mode=OneWay}"
                              IsEnabled="{x:Bind IsEditable, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}"
                              SelectsOnInvoked="{x:Bind SelectsOnInvoked, Mode=OneWay}">
            <NavigationViewItem.Icon>
              <IconSourceElement IconSource="{x:Bind Icon, Converter={StaticResource IconToIconSourceConverter}, Mode=OneWay}" />
            </NavigationViewItem.Icon>
          </NavigationViewItem>
        </DataTemplate>
      </views:MainNavigationViewMenuItemTemplateSelector.MenuItemTemplate>
      <!--#endregion-->

      <!--#region SeparatorTemplate-->
      <views:MainNavigationViewMenuItemTemplateSelector.SeparatorTemplate>
        <DataTemplate x:DataType="models:NavigationSeparator">
          <NavigationViewItemSeparator />
        </DataTemplate>
      </views:MainNavigationViewMenuItemTemplateSelector.SeparatorTemplate>
      <!--#endregion-->

      <!--#region MenuItemTemplate: Board Group-->
      <views:MainNavigationViewMenuItemTemplateSelector.BoardGroupMenuItemTemplate>
        <DataTemplate x:DataType="models:NavigationBoardGroup">
          <views:AppNavigationViewItem DataContext="{x:Bind}"
                                       MenuItemsSource="{x:Bind Children}"
                                       IsExpanded="False"
                                       CanDrag="{x:Bind IsEditable, Mode=OneWay}"
                                       PresenterDragStarting="NavigationViewItem_DragStarting"
                                       PresenterDropCompleted="NavigationViewItem_DropCompleted"
                                       AllowDrop="{x:Bind IsEditable, Mode=OneWay}"
                                       DragOver="GroupNavigationViewItem_DragOver"
                                       DragLeave="NavigationViewItem_DragLeave"
                                       Drop="NavigationViewItem_DragLeave"
                                       SelectsOnInvoked="{x:Bind IsEditable, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}">
            <views:AppNavigationViewItem.Resources>
              <x:Double x:Key="NavigationViewItemOnLeftMinHeight">32</x:Double>
            </views:AppNavigationViewItem.Resources>
            <views:AppNavigationViewItem.Content>
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0"
                           Text="{x:Bind Name, Mode=OneWay}"
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis"
                           FontWeight="SemiBold" />
                <Button Grid.Column="1"
                        Style="{StaticResource AppFontIconMediumButtonStyle}"
                        Content="&#xE712;"
                        Width="24"
                        Height="24"
                        Visibility="{x:Bind IsEditable, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
              </Grid>
            </views:AppNavigationViewItem.Content>
            <views:AppNavigationViewItem.Icon>
              <IconSourceElement IconSource="{x:Bind Icon, Converter={StaticResource IconToIconSourceConverter}, Mode=OneWay}" />
            </views:AppNavigationViewItem.Icon>
            <views:AppNavigationViewItem.ContextFlyout>
              <MenuFlyout Placement="Bottom">
                <views:AppMenuFlyoutItem>
                  <TextBlock Text="{x:Bind Name, Mode=OneWay}"
                             Style="{StaticResource BodyStrongTextBlockStyle}" />
                </views:AppMenuFlyoutItem>
                <MenuFlyoutSeparator />
                <MenuFlyoutItem x:Name="View_NavigationViewBoardGroupItem_RenameMenuFlyoutItem"
                                Text="Rename"
                                Icon="Rename"
                                Click="View_NavigationViewBoardItem_RenameMenuFlyoutItem_Click" />
                <MenuFlyoutItem x:Name="View_NavigationViewBoardGroupItem_NewGroupMenuFlyoutItem"
                                Text="New group"
                                Icon="Add"
                                Click="View_NavigationViewBoardGroupItem_NewGroupMenuFlyoutItem_Click" />
                <MenuFlyoutItem x:Name="View_NavigationViewBoardGroupItem_NewBoardMenuFlyoutItem"
                                Text="New board"
                                Icon="Add"
                                Click="View_NavigationViewBoardGroupItem_NewBoardMenuFlyoutItem_Click" />
                <MenuFlyoutSeparator />
                <MenuFlyoutItem Text="Remove"
                                Icon="Delete" />
              </MenuFlyout>
            </views:AppNavigationViewItem.ContextFlyout>
          </views:AppNavigationViewItem>
        </DataTemplate>
      </views:MainNavigationViewMenuItemTemplateSelector.BoardGroupMenuItemTemplate>
      <!--#endregion-->

      <!--#region MenuItemTemplate: Board-->
      <views:MainNavigationViewMenuItemTemplateSelector.BoardMenuItemTemplate>
        <DataTemplate x:DataType="models:NavigationBoard">
          <views:AppNavigationViewItem DataContext="{x:Bind}"
                                       CanDrag="{x:Bind IsEditable, Mode=OneWay}"
                                       PresenterDragStarting="NavigationViewItem_DragStarting"
                                       PresenterDropCompleted="NavigationViewItem_DropCompleted"
                                       AllowDrop="{x:Bind IsEditable, Mode=OneWay}"
                                       DragOver="ItemNavigationViewItem_DragOver"
                                       DragLeave="NavigationViewItem_DragLeave"
                                       SelectsOnInvoked="{x:Bind IsEditable, Mode=OneWay, Converter={StaticResource BoolNegationConverter}}">
            <views:AppNavigationViewItem.Resources>
              <x:Double x:Key="NavigationViewItemOnLeftMinHeight">32</x:Double>
            </views:AppNavigationViewItem.Resources>
            <views:AppNavigationViewItem.Content>
              <Grid>
                <Grid.ColumnDefinitions>
                  <ColumnDefinition />
                  <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Text="{x:Bind Name, Mode=OneWay}"
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis" />
                <Button Grid.Column="1"
                        Style="{StaticResource AppFontIconMediumButtonStyle}"
                        Content="&#xE712;"
                        Width="24"
                        Height="24"
                        Visibility="{x:Bind IsEditable, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
              </Grid>
            </views:AppNavigationViewItem.Content>
            <views:AppNavigationViewItem.Icon>
              <IconSourceElement IconSource="{x:Bind Icon, Converter={StaticResource IconToIconSourceConverter}, Mode=OneWay}" />
            </views:AppNavigationViewItem.Icon>
            <views:AppNavigationViewItem.ContextFlyout>
              <MenuFlyout Placement="Bottom">
                <views:AppMenuFlyoutItem>
                  <TextBlock Text="{x:Bind Name}"
                             Style="{StaticResource BodyStrongTextBlockStyle}" />
                </views:AppMenuFlyoutItem>
                <MenuFlyoutSeparator />
                <MenuFlyoutItem x:Name="View_NavigationViewBoardItem_RenameMenuFlyoutItem"
                                Text="Rename"
                                Icon="Rename"
                                Click="View_NavigationViewBoardItem_RenameMenuFlyoutItem_Click" />
                <MenuFlyoutSeparator />
                <MenuFlyoutItem Text="Remove"
                                Icon="Delete" />
              </MenuFlyout>
            </views:AppNavigationViewItem.ContextFlyout>
          </views:AppNavigationViewItem>
        </DataTemplate>
      </views:MainNavigationViewMenuItemTemplateSelector.BoardMenuItemTemplate>
    </views:MainNavigationViewMenuItemTemplateSelector>
    <!--#endregion-->
  </Page.Resources>

  <Grid x:Name="View_RootGrid">
    <Grid.RowDefinitions>
      <RowDefinition Height="48" />
      <RowDefinition />
    </Grid.RowDefinitions>

    <TitleBar x:Name="View_TitleBar"
              Grid.Row="0"
              IsBackButtonEnabled="{x:Bind View_NavigationContent_RootFrame.CanGoBack, Mode=OneWay}"
              IsBackButtonVisible="True"
              BackRequested="View_TitleBar_BackRequested"
              IsPaneToggleButtonVisible="True"
              PaneToggleRequested="View_TitleBar_PaneToggleRequested"
              Margin="2,0,0,0"
              Title="MyNotes">
      <TitleBar.IconSource>
        <ImageIconSource ImageSource="ms-appx:///Assets/icons/app/AppIcon_16.png" />
      </TitleBar.IconSource>
      <TitleBar.RightHeader>
        <Button Style="{StaticResource AppFontIconNormalButtonStyle}"
                Width="100"
                Content="&#xEC7A;"
                Click="ViewWindowsButton_Click" >
          <!--<Button.Flyout>
            <MenuFlyout Placement="Bottom">
              <MenuFlyoutItem Text="View Windows and Pages"
                              Click="ViewWindowsButton_Click" />
              <MenuFlyoutItem Text="Test Window"
                              Click="TestWindowButton_Click" />
            </MenuFlyout>
          </Button.Flyout>-->
        </Button>
      </TitleBar.RightHeader>
    </TitleBar>

    <NavigationView x:Name="View_NavigationView"
                    Grid.Row="1"
                    IsBackButtonVisible="Collapsed"
                    IsPaneToggleButtonVisible="False"
                    IsSettingsVisible="False"
                    MenuItemTemplateSelector="{StaticResource MainNavigationViewMenuItemTemplateSelector}"
                    MenuItemsSource="{x:Bind ViewModel.MenuItems.View}"
                    FooterMenuItemsSource="{x:Bind ViewModel.FooterMenuItems}"
                    SelectionChanged="View_NavigationView_SelectionChanged"
                    ItemInvoked="View_NavigationView_ItemInvoked"
                    Loaded="View_NavigationView_Loaded">
      <NavigationView.AutoSuggestBox>
        <AutoSuggestBox x:Name="View_NavigationVIew_AutoSuggestBox"
                        PlaceholderText="Search notes"
                        QueryIcon="Find"
                        QuerySubmitted="AutoSuggestBox_QuerySubmitted">
        </AutoSuggestBox>
      </NavigationView.AutoSuggestBox>

      <NavigationView.Content>
        <Frame x:Name="View_NavigationContent_RootFrame"
               Padding="12,0,0,0"
               Navigated="View_NavigationContent_RootFrame_Navigated" />
      </NavigationView.Content>

      <NavigationView.PaneFooter>
        <StackPanel Spacing="4">
          <Grid Padding="4,0">
            <Grid.ColumnDefinitions>
              <ColumnDefinition />
              <ColumnDefinition />
              <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <views:AppCompoundButton x:Name="View_NavigationViewFooter_NewGroupButton"
                                     Grid.Column="0"
                                     Content="New group"
                                     Icon="{ui:FontIcon Glyph=&#xE82E;}"
                                     Style="{StaticResource AppNavigationButtonStyle}"
                                     Click="View_NavigationViewFooter_NewGroupButton_Click" />
            <views:AppCompoundButton x:Name="View_NavigationViewFooter_NewBoardButton"
                                     Grid.Column="1"
                                     Content="New board"
                                     Icon="{ui:FontIcon Glyph=&#xED0E;}"
                                     Style="{StaticResource AppNavigationButtonStyle}"
                                     Click="View_NavigationViewFooter_NewBoardButton_Click" />
            <views:AppCompoundButton x:Name="View_NavigationViewFooter_EditNavigationViewItem"
                                     Grid.Column="2"
                                     Icon="{ui:FontIcon Glyph=&#xE932;}"
                                     Style="{StaticResource AppNavigationButtonStyle}"
                                     ToolTipService.ToolTip="Edit"
                                     Click="View_NavigationViewFooter_EditNavigationViewItem_Click" />
          </Grid>
          <NavigationViewItemSeparator />
        </StackPanel>
      </NavigationView.PaneFooter>
    </NavigationView>

    <TeachingTip x:Name="View_EditTeachingTip"
                 Target="{x:Bind View_NavigationViewFooter_EditNavigationViewItem}"
                 Title="Turn off edit mode to select item."
                 IsLightDismissEnabled="True" />

    <!--#region Rename Board ContentDialog-->
    <ContentDialog x:Name="View_RenameBoardContentDialog"
                   Title="Rename"
                   PrimaryButtonText="OK"
                   IsPrimaryButtonEnabled="{x:Bind View_RenameBoardInputTextBox.Text, Converter={StaticResource EmptyStringToBoolConverter}, Mode=OneWay}"
                   CloseButtonText="Cancel"
                   DefaultButton="Primary">
      <Grid ColumnSpacing="8">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="Auto" />
          <ColumnDefinition />
        </Grid.ColumnDefinitions>
        <Button Grid.Column="0"
                Style="{StaticResource AppIconMediumButtonStyle}">
          <IconSourceElement IconSource="{Binding Icon, Converter={StaticResource IconToIconSourceConverter}, Mode=OneWay}" />
          <Button.Flyout>
            <Flyout Placement="BottomEdgeAlignedLeft"
                    ShouldConstrainToRootBounds="False">
              <views:IconPicker Icon="{Binding Icon, Mode=TwoWay}" />
            </Flyout>
          </Button.Flyout>
        </Button>
        <TextBox x:Name="View_RenameBoardInputTextBox"
                 Grid.Column="1"
                 VerticalAlignment="Center"
                 PlaceholderText="Enter name" />
      </Grid>
    </ContentDialog>
    <!--#endregion-->

    <!--#region New Board Group ContentDialog -->
    <ContentDialog x:Name="View_NewBoardGroupContentDialog"
                   Title="New board"
                   PrimaryButtonText="Add"
                   IsPrimaryButtonEnabled="{x:Bind View_NewBoardGroupInputTextBox.Text, Converter={StaticResource EmptyStringToBoolConverter}, Mode=OneWay}"
                   CloseButtonText="Cancel"
                   DefaultButton="Primary">
      <StackPanel Spacing="8">
        <StackPanel Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Spacing="8">
          <TextBlock Text="Add item as"
                     VerticalAlignment="Center" />
          <ComboBox x:Name="View_NewBoardGroupOptionsComboBox"
                    SelectedIndex="0"
                    HorizontalAlignment="Right"
                    MinWidth="120">
            <ComboBoxItem Content="root" />
            <ComboBoxItem Content="child of selected"
                          IsEnabled="{x:Bind View_NavigationView.SelectedItem, Converter={StaticResource NavigationBoardGroupToBoolConverter}, Mode=OneWay}" />
            <ComboBoxItem Content="sibling of selected"
                          IsEnabled="{x:Bind View_NavigationView.SelectedItem, Converter={StaticResource NavigationBoardToBoolConverter}, Mode=OneWay}" />
          </ComboBox>
        </StackPanel>
        <Grid ColumnSpacing="8">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition />
          </Grid.ColumnDefinitions>
          <Button Grid.Column="0"
                  Style="{StaticResource AppIconMediumButtonStyle}">
            <IconSourceElement IconSource="{x:Bind ViewModel.NewBoardGroupIcon, Converter={StaticResource IconToIconSourceConverter}, Mode=OneWay}" />
            <Button.Flyout>
              <Flyout Placement="BottomEdgeAlignedLeft"
                      ShouldConstrainToRootBounds="False">
                <views:IconPicker Icon="{x:Bind ViewModel.NewBoardGroupIcon, Mode=TwoWay}" />
              </Flyout>
            </Button.Flyout>
          </Button>
          <TextBox x:Name="View_NewBoardGroupInputTextBox"
                   Grid.Column="1"
                   VerticalAlignment="Center"
                   PlaceholderText="Enter group name" />
        </Grid>
      </StackPanel>
    </ContentDialog>
    <!--#endregion-->

    <!--#region New Board ContentDialog -->
    <ContentDialog x:Name="View_NewBoardContentDialog"
                   Title="New board"
                   PrimaryButtonText="Add"
                   IsPrimaryButtonEnabled="{x:Bind View_NewBoardInputTextBox.Text, Converter={StaticResource EmptyStringToBoolConverter}, Mode=OneWay}"
                   CloseButtonText="Cancel"
                   DefaultButton="Primary">
      <StackPanel Spacing="8">
        <StackPanel Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Spacing="8">
          <TextBlock Text="Add item as"
                     VerticalAlignment="Center" />
          <ComboBox x:Name="View_NewBoardOptionsComboBox"
                    SelectedIndex="0"
                    HorizontalAlignment="Right"
                    MinWidth="120">
            <ComboBoxItem Content="root" />
            <ComboBoxItem Content="child of selected"
                          IsEnabled="{x:Bind View_NavigationView.SelectedItem, Converter={StaticResource NavigationBoardGroupToBoolConverter}, Mode=OneWay}" />
            <ComboBoxItem Content="sibling of selected"
                          IsEnabled="{x:Bind View_NavigationView.SelectedItem, Converter={StaticResource NavigationBoardToBoolConverter}, Mode=OneWay}" />
          </ComboBox>
        </StackPanel>
        <Grid ColumnSpacing="8">
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition />
          </Grid.ColumnDefinitions>
          <Button Grid.Column="0"
                  Style="{StaticResource AppIconMediumButtonStyle}">
            <IconSourceElement IconSource="{x:Bind ViewModel.NewBoardIcon, Converter={StaticResource IconToIconSourceConverter}, Mode=OneWay}" />
            <Button.Flyout>
              <Flyout Placement="BottomEdgeAlignedLeft"
                      ShouldConstrainToRootBounds="False">
                <views:IconPicker Icon="{x:Bind ViewModel.NewBoardIcon, Mode=TwoWay}" />
              </Flyout>
            </Button.Flyout>
          </Button>
          <TextBox x:Name="View_NewBoardInputTextBox"
                   Grid.Column="1"
                   VerticalAlignment="Center"
                   PlaceholderText="Enter board name" />
        </Grid>
      </StackPanel>
    </ContentDialog>
    <!--#endregion-->
  </Grid>

  <FlyoutBase.AttachedFlyout>
    <Flyout x:Name="View_TagsFlyout"
            Placement="RightEdgeAlignedTop">
      <Flyout.FlyoutPresenterStyle>
        <Style TargetType="FlyoutPresenter"
               BasedOn="{StaticResource DefaultFlyoutPresenterStyle}">
          <Setter Property="Padding"
                  Value="0" />
        </Style>
      </Flyout.FlyoutPresenterStyle>
      <views:TagsEditor />
    </Flyout>
  </FlyoutBase.AttachedFlyout>
</Page>
