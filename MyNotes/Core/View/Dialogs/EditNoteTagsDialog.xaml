<?xml version="1.0" encoding="utf-8"?>
<ContentDialog x:Class="MyNotes.Core.View.EditNoteTagsDialog"
               xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
               xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
               xmlns:view="using:MyNotes.Core.View"
               xmlns:model="using:MyNotes.Core.Model"
               xmlns:controls="using:CommunityToolkit.WinUI.Controls"
               Title="Edit Tags"
               CloseButtonText="Close"
               DefaultButton="Close"
               Style="{StaticResource DefaultContentDialogStyle}">
  <Grid Width="350"
        MaxHeight="300"
        RowSpacing="12">
    <Grid.RowDefinitions>
      <RowDefinition MinHeight="40" />
      <RowDefinition Height="Auto" />
    </Grid.RowDefinitions>
    <ScrollView Grid.Row="0"
                ContentOrientation="Vertical"
                HorizontalScrollMode="Disabled"
                VerticalScrollMode="Enabled"
                HorizontalScrollBarVisibility="Hidden"
                VerticalScrollBarVisibility="Visible"
                BorderBrush="{StaticResource CardStrokeColorDefault}"
                BorderThickness="1"
                Padding="8">
      <ItemsRepeater x:Name="View_EditNoteTagsItemsRepeater"
                     ItemsSource="{x:Bind ViewModel.Note.Tags}">
        <ItemsRepeater.Layout>
          <!--<LinedFlowLayout ItemsStretch="None"
                           ItemsJustification="SpaceEvenly" 
                           MinItemSpacing="4"
                           LineSpacing="4"/>-->
          <controls:WrapLayout HorizontalSpacing="4"
                               VerticalSpacing="4" />
        </ItemsRepeater.Layout>

        <ItemsRepeater.ItemTemplate>
          <DataTemplate x:DataType="model:Tag">
            <view:AppTagButton DeleteButtonVisible="Visible"
                               Background="{x:Bind Color, Converter={StaticResource TagColorToBackgroundBrushConverter}, Mode=OneWay}"
                               Foreground="{x:Bind Color, Converter={StaticResource TagColorToForegroundBrushConverter}, Mode=OneWay}">
              <TextBlock Text="{x:Bind Text}"
                         TextTrimming="CharacterEllipsis" />
            </view:AppTagButton>
          </DataTemplate>
        </ItemsRepeater.ItemTemplate>
      </ItemsRepeater>
    </ScrollView>

    <Grid Grid.Row="1"
          ColumnSpacing="8">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto" />
        <ColumnDefinition />
        <ColumnDefinition Width="Auto" />
      </Grid.ColumnDefinitions>
      <Button Grid.Column="0"
              Style="{StaticResource AppIconMediumButtonStyle}">
        <Button.Resources>
          <Style x:Key="BorderStyle"
                 TargetType="Border">
            <Setter Property="Width"
                    Value="20" />
            <Setter Property="Height"
                    Value="20" />
            <Setter Property="BorderThickness"
                    Value="2" />
            <Setter Property="CornerRadius"
                    Value="2" />
          </Style>
        </Button.Resources>

        <Border ToolTipService.ToolTip="Transparent"
                Background="#09000000"
                BorderBrush="#E4000000"
                Style="{StaticResource BorderStyle}" />

        <Button.Flyout>
          <Flyout Placement="TopEdgeAlignedLeft">
            <GridView Header="Tag color"
                      HeaderTemplate="{StaticResource AppBoldTextHeaderTemplate}"
                      Padding="0"
                      SelectionMode="Single"
                      SelectedIndex="0">
 
              <Border ToolTipService.ToolTip="Transparent"
                      Background="#09000000"
                      BorderBrush="#E4000000"
                      Style="{StaticResource BorderStyle}" />
              <Border ToolTipService.ToolTip="Red"
                      Background="#FFFFEBEB"
                      BorderBrush="#FFD60000"
                      Style="{StaticResource BorderStyle}" />
              <Border ToolTipService.ToolTip="Orange"
                      Background="#FFFFF3E0"
                      BorderBrush="#FFE68A00"
                      Style="{StaticResource BorderStyle}" />
              <Border ToolTipService.ToolTip="Yellow"
                      Background="#FFFFFBE6"
                      BorderBrush="#FFB39500"
                      Style="{StaticResource BorderStyle}" />
              <Border ToolTipService.ToolTip="Green"
                      Background="#FFEDFFE0"
                      BorderBrush="#FF50991F"
                      Style="{StaticResource BorderStyle}" />
              <Border ToolTipService.ToolTip="Mint"
                      Background="#FFE0FFF0"
                      BorderBrush="#FF338059"
                      Style="{StaticResource BorderStyle}" />
              <Border ToolTipService.ToolTip="Aqua"
                      Background="#FFE0FFFF"
                      BorderBrush="#FF009999"
                      Style="{StaticResource BorderStyle}" />
              <Border ToolTipService.ToolTip="Blue"
                      Background="#FFE0EBFF"
                      BorderBrush="#FF0047D6"
                      Style="{StaticResource BorderStyle}" />
              <Border ToolTipService.ToolTip="Violet"
                      Background="#FFF8EBFF"
                      BorderBrush="#FF8F00D6"
                      Style="{StaticResource BorderStyle}" />

              <GridView.ItemsPanel>
                <ItemsPanelTemplate>
                  <ItemsWrapGrid MaximumRowsOrColumns="5"
                                 Orientation="Horizontal"
                                 Margin="0,8,0,0" />
                </ItemsPanelTemplate>
              </GridView.ItemsPanel>
            </GridView>
          </Flyout>
        </Button.Flyout>
      </Button>
      <AutoSuggestBox x:Name="View_AddTagAutoSuggestBox"
                      Grid.Column="1" />
      <Button x:Name="View_AddTagButton"
              Grid.Column="2"
              Content="Add"
              Command="{x:Bind ViewModel.AddTagCommand}"
              CommandParameter="{Binding ElementName=View_AddTagAutoSuggestBox, Path=Text}" />
    </Grid>
  </Grid>
</ContentDialog>
